<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BizzDash Dashboard</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --bg-primary: #F9FAFB;
            --sidebar-bg: #02042B;
            --accent-blue: #3395FF;
            --success-bg: #D1FAE5;
            --success-text: #065F46;
            --pending-bg: #FEF3C7;
            --pending-text: #92400E;
            --failed-bg: #FEE2E2;
            --failed-text: #991B1B;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-primary); overflow-x: hidden; }
        .sidebar { position: fixed; left: 0; top: 0; width: 240px; height: 100vh; background-color: var(--sidebar-bg); padding: 24px 0; z-index: 100; transition: all 0.3s ease; }
        .sidebar-logo { padding: 0 20px 32px; font-size: 24px; font-weight: 700; color: white; letter-spacing: -0.5px; }
        .sidebar-nav { list-style: none; }
        .sidebar-nav-item { padding: 12px 20px; margin: 2px 12px; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; gap: 12px; color: rgba(255,255,255,0.7); font-size: 14px; font-weight: 500; }
        .sidebar-nav-item:hover { background-color: rgba(255,255,255,0.08); color: white; }
        .sidebar-nav-item.active { background-color: rgba(51,149,255,0.15); color: var(--accent-blue); }
        .sidebar-icon { width: 20px; height: 20px; stroke-width: 2; }
        .main-content { margin-left: 240px; min-height: 100vh; }
        .header { background: white; border-bottom: 1px solid #E5E7EB; padding: 16px 32px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 50; }
        .business-view { display: flex; align-items: center; gap: 8px; font-size: 14px; color: #6B7280; }
        .business-name { font-weight: 600; color: #111827; }
        .search-bar { flex: 1; max-width: 400px; margin: 0 40px; }
        .search-input { width: 100%; padding: 10px 16px 10px 40px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 14px; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='none' stroke='%236B7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='8' cy='8' r='6'/%3E%3Cpath d='m13 13 3 3'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: 12px center; transition: border-color 0.2s; }
        .search-input:focus { outline: none; border-color: var(--accent-blue); }
        .profile-dropdown { display: flex; align-items: center; gap: 12px; cursor: pointer; padding: 8px 12px; border-radius: 8px; transition: background-color 0.2s; }
        .profile-dropdown:hover { background-color: #F3F4F6; }
        .profile-avatar { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, var(--accent-blue), #0EA5E9); display: flex; align-items: center; justify-content: center; color: white; font-size: 13px; font-weight: 600; }
        .content-area { padding: 32px; }
        .page-title { font-size: 28px; font-weight: 700; color: #111827; margin-bottom: 24px; letter-spacing: -0.5px; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 20px; margin-bottom: 32px; }
        .metric-card { background: white; border: 1px solid #F3F4F6; border-radius: 12px; padding: 24px; transition: all 0.3s ease; }
        .metric-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.06); transform: translateY(-2px); }
        .metric-label { font-size: 13px; font-weight: 400; color: #6B7280; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
        .metric-value { font-size: 32px; font-weight: 700; color: #111827; margin-bottom: 8px; letter-spacing: -1px; }
        .metric-change { font-size: 13px; font-weight: 500; display: flex; align-items: center; gap: 4px; }
        .metric-change.positive { color: #059669; }
        .metric-change.negative { color: #DC2626; }
        .chart-container { background: white; border: 1px solid #F3F4F6; border-radius: 12px; padding: 28px; margin-bottom: 32px; }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .chart-title { font-size: 18px; font-weight: 600; color: #111827; }
        .chart-timeframe { display: flex; gap: 8px; }
        .timeframe-btn { padding: 6px 14px; border: 1px solid #E5E7EB; border-radius: 6px; background: white; font-size: 13px; font-weight: 500; color: #6B7280; cursor: pointer; transition: all 0.2s; }
        .timeframe-btn:hover { border-color: var(--accent-blue); color: var(--accent-blue); }
        .timeframe-btn.active { background-color: var(--accent-blue); border-color: var(--accent-blue); color: white; }
        .transactions-container { background: white; border: 1px solid #F3F4F6; border-radius: 12px; overflow: hidden; }
        .transactions-header { padding: 24px 28px; border-bottom: 1px solid #F3F4F6; display: flex; justify-content: space-between; align-items: center; }
        .transactions-title { font-size: 18px; font-weight: 600; color: #111827; }
        .view-all-link { font-size: 14px; font-weight: 500; color: var(--accent-blue); text-decoration: none; cursor: pointer; transition: color 0.2s; }
        .view-all-link:hover { color: #2563EB; }
        .transactions-table { width: 100%; border-collapse: collapse; }
        .transactions-table thead { background-color: #F9FAFB; }
        .transactions-table th { padding: 14px 28px; text-align: left; font-size: 12px; font-weight: 600; color: #6B7280; text-transform: uppercase; letter-spacing: 0.5px; }
        .transactions-table td { padding: 18px 28px; border-top: 1px solid #F3F4F6; font-size: 14px; color: #374151; }
        .transaction-id { font-family: 'Courier New', monospace; font-size: 13px; color: #6B7280; }
        .payment-method { display: inline-flex; align-items: center; gap: 6px; font-weight: 500; }
        .status-badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; letter-spacing: 0.3px; }
        .status-success { background-color: var(--success-bg); color: var(--success-text); }
        .status-pending { background-color: var(--pending-bg); color: var(--pending-text); }
        .status-failed { background-color: var(--failed-bg); color: var(--failed-text); }
        .amount { font-weight: 600; color: #111827; }
        @keyframes countUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .counter-animate { animation: countUp 0.5s ease-out; }

        /* ---- Loader styles ---- */
        .loader-overlay { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(249,250,251,0.9); z-index: 9999; transition: opacity 0.3s ease; }
        .spinner { width: 64px; height: 64px; border-radius: 50%; border: 6px solid rgba(0,0,0,0.08); border-top-color: var(--accent-blue); animation: spin 1s linear infinite; box-shadow: 0 6px 18px rgba(51,149,255,0.12); }
        @keyframes spin { to { transform: rotate(360deg); } }
        /* ---- end loader styles ---- */

        /* Expanded details row */
        .expanded-row { background: #ffffff; transition: max-height 0.32s ease, opacity 0.32s ease; overflow: hidden; }
        .expanded-content { padding: 12px 28px 20px 28px; border-top: 1px solid #F3F4F6; display: grid; grid-template-columns: 1fr 200px; gap: 16px; align-items: center; }
        .expanded-content .meta { font-size: 14px; color: #374151; }
        .expanded-content .meta b { color: #111827; }

        @media (max-width: 1024px) {
            .sidebar { width: 80px; }
            .sidebar-logo { font-size: 20px; text-align: center; }
            .sidebar-nav-item span { display: none; }
            .main-content { margin-left: 80px; }
            .search-bar { display: none; }
        }
        @media (max-width: 768px) { .metrics-grid { grid-template-columns: 1fr; } .content-area { padding: 20px; } .header { padding: 16px 20px; } }
    </style>
</head>
<body>
    <!-- Loader overlay (shows on reload) -->
    <div id="loader" class="loader-overlay" aria-hidden="true">
        <div class="spinner" role="status" aria-label="Loading"></div>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-logo">BizzDash</div>
        <ul class="sidebar-nav">
            <li class="sidebar-nav-item active"> ... </li>
            <li class="sidebar-nav-item"> ... </li>
            <li class="sidebar-nav-item"> ... </li>
            <li class="sidebar-nav-item"> ... </li>
            <li class="sidebar-nav-item"> ... </li>
        </ul>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="business-view">
                <span>Business:</span>
                <span class="business-name">Devsocs</span>
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </div>
            
            <div class="search-bar">
                <input id="searchInput" type="text" class="search-input" placeholder="Search transactions, payments...">
            </div>
            
            <div class="profile-dropdown">
                <div class="profile-avatar">AC</div>
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </div>
        </header>

        <!-- Content Area -->
        <div class="content-area">
            <h1 class="page-title">Dashboard Overview</h1>
            
            <!-- Metrics Grid -->
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Total Earnings</div>
                    <div class="metric-value" id="totalEarnings">₹3,26,711</div>
                    <div class="metric-change positive">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                        <span id="earningsChange">+12.5% from last month</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-label">Current Balance</div>
                    <div class="metric-value" id="currentBalance">₹59,433</div>
                    <div class="metric-change positive">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                        <span>+8.2% from last month</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-label">Pending Settlements</div>
                    <div class="metric-value" id="pendingSettlements">₹14,867</div>
                    <div class="metric-change" style="color: #6B7280;">
                        <span>Processing <span id="processingCount">4</span> payments</span>
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-label">Refunds</div>
                    <div class="metric-value" id="refundsTotal">₹3,450</div>
                    <div class="metric-change negative">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path></svg>
                        <span>4 transactions this month</span>
                    </div>
                </div>
            </div>

            <!-- Revenue Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Revenue - last 30 days</h2>
                    <div class="chart-timeframe">
                        <button class="timeframe-btn" data-days="7">7D</button>
                        <button class="timeframe-btn active" data-days="30">30D</button>
                        <button class="timeframe-btn" data-days="90">90D</button>
                        <button class="timeframe-btn" data-days="365">1Y</button>
                    </div>
                </div>
                <canvas id="revenueChart" height="80"></canvas>
            </div>

            <!-- Recent Transactions -->
            <div class="transactions-container">
                <div class="transactions-header">
                    <h2 class="transactions-title">Recent Transactions</h2>
                    <a class="view-all-link">View All →</a>
                </div>
                <table class="transactions-table" id="transactionsTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Transaction ID</th>
                            <th>Method</th>
                            <th>Amount</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="transactionsBody">
                        <!-- Filled by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // Utility: Indian currency formatting
        const fmtINR = (v) => '₹' + Number(v).toLocaleString('en-IN');

        // Initial totals (these drive the chart data generation so the chart "matches" the dashboard numbers)
        const totals = {
            totalEarnings: 326711,
            currentBalance: 59433,
            pendingSettlements: 14867,
            refundsTotal: 3450
        };

        // Update metric displays from totals
        document.getElementById('totalEarnings').textContent = fmtINR(totals.totalEarnings);
        document.getElementById('currentBalance').textContent = fmtINR(totals.currentBalance);
        document.getElementById('pendingSettlements').textContent = fmtINR(totals.pendingSettlements);
        document.getElementById('refundsTotal').textContent = fmtINR(totals.refundsTotal);

        // Mock transactions (real-looking but fake) — newest first
        const transactions = [
            {
                date: 'Jan 28, 2026', id: 'TXN_8H9I0J1K2L', method: 'UPI', amount: 9500, status: 'success', details: {
                    payer: 'Nexa Tech Pvt Ltd', service: 'Landing page + SEO', invoice: 'INV-2026-101', reference: 'UPI: nexa@okhdfc', fees: 190, net: 9310, notes: 'Paid via business UPI — project milestone 1 of 2.'
                }
            },
            {
                date: 'Jan 27, 2026', id: 'TXN_4M5N6O7P8Q', method: 'Card', amount: 6200, status: 'pending', details: {
                    payer: 'GreenLeaf Interiors', service: 'UI design (small)', invoice: 'INV-2026-098', reference: 'Card **** 4242', fees: 124, net: 6076, notes: 'Awaiting settlement from bank.'
                }
            },
            {
                date: 'Jan 21, 2026', id: 'TXN_4F8G9H2K3L', method: 'Card', amount: 7500, status: 'success', details: {
                    payer: 'Astra Events', service: 'Website + booking plugin', invoice: 'INV-2026-083', reference: 'Card **** 1122', fees: 150, net: 7350, notes: 'Full payment for event microsite.'
                }
            },
            {
                date: 'Jan 18, 2026', id: 'TXN_7M9N4P5Q6R', method: 'UPI', amount: 8750, status: 'success', details: {
                    payer: 'Fito Labs', service: 'Shopify theme setup', invoice: 'INV-2026-074', reference: 'UPI: fito@okhdfc', fees: 175, net: 8575, notes: 'Paid for 499-pack + customizations.'
                }
            },
            {
                date: 'Jan 16, 2026', id: 'TXN_2S8T3U4V5W', method: 'UPI', amount: 5200, status: 'pending', details: {
                    payer: 'Mistri Builders', service: 'Landing page (prototype)', invoice: 'INV-2026-069', reference: 'UPI: mistribuild@okhdfc', fees: 104, net: 5096, notes: 'Client requested edits, hold for confirmation.'
                }
            },
            {
                date: 'Jan 12, 2026', id: 'TXN_6X7Y8Z9A1B', method: 'Card', amount: 8000, status: 'success', details: {
                    payer: 'Karma Coffee Co', service: 'E‑commerce front-end', invoice: 'INV-2026-054', reference: 'Card **** 6677', fees: 160, net: 7840, notes: 'Small refund processed later.'
                }
            },
            {
                date: 'Jan 10, 2026', id: 'TXN_3C4D5E6F7G', method: 'Card', amount: 3450, status: 'failed', details: {
                    payer: 'Bright Tutors', service: 'Consultation deposit', invoice: 'INV-2026-042', reference: 'Card declined', fees: 0, net: 0, notes: 'Payment failed at authorization.'
                }
            }
        ];

        // Build transactions table rows + expansion logic
        const tbody = document.getElementById('transactionsBody');

        function statusBadge(status) {
            if (status === 'success') return `<span class="status-badge status-success">Success</span>`;
            if (status === 'pending') return `<span class="status-badge status-pending">Pending</span>`;
            return `<span class="status-badge status-failed">Failed</span>`;
        }

        function methodIcon(method) {
            if (method === 'Card') return `<svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path></svg>`;
            return `<svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>`;
        }

        function renderTransactions(list) {
            tbody.innerHTML = '';
            list.forEach((t, i) => {
                const tr = document.createElement('tr');
                tr.className = 'tx-row cursor-pointer';
                tr.dataset.index = i;
                tr.innerHTML = `
                    <td>${t.date}</td>
                    <td class="transaction-id">${t.id}</td>
                    <td><span class="payment-method">${methodIcon(t.method)} ${t.method}</span></td>
                    <td class="amount">${fmtINR(t.amount)}</td>
                    <td>${statusBadge(t.status)}</td>
                `;
                tbody.appendChild(tr);

                // Insert expandable placeholder row
                const expandTr = document.createElement('tr');
                expandTr.className = 'expanded-row';
                expandTr.style.maxHeight = '0px';
                expandTr.style.opacity = '0';
                expandTr.innerHTML = `
                    <td colspan="5">
                        <div class="expanded-content" aria-hidden="true">
                            <div class="meta">
                                <div><b>Payer:</b> ${t.details.payer}</div>
                                <div><b>Service:</b> ${t.details.service}</div>
                                <div><b>Invoice:</b> ${t.details.invoice}</div>
                                <div><b>Reference:</b> ${t.details.reference}</div>
                                <div style="margin-top:6px; color:#6B7280; font-size:13px"><b>Notes:</b> ${t.details.notes}</div>
                            </div>
                            <div style="text-align:right">
                                <div><b>Gross:</b> ${fmtINR(t.amount)}</div>
                                <div><b>Fees:</b> ${fmtINR(t.details.fees)}</div>
                                <div style="margin-top:8px; font-size:16px"><b>Net:</b> ${fmtINR(t.details.net)}</div>
                            </div>
                        </div>
                    </td>
                `;
                tbody.appendChild(expandTr);

                // Toggle expand on click
                tr.addEventListener('click', () => {
                    const isOpen = expandTr.style.maxHeight && expandTr.style.maxHeight !== '0px';
                    // close any open ones first
                    document.querySelectorAll('.expanded-row').forEach(r => {
                        r.style.maxHeight = '0px'; r.style.opacity = '0'; r.querySelector('.expanded-content').setAttribute('aria-hidden', 'true');
                    });
                    if (!isOpen) {
                        expandTr.style.maxHeight = '240px';
                        expandTr.style.opacity = '1';
                        expandTr.querySelector('.expanded-content').setAttribute('aria-hidden', 'false');
                        // smooth scroll into view for mobile
                        expandTr.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    } else {
                        expandTr.style.maxHeight = '0px'; expandTr.style.opacity = '0'; expandTr.querySelector('.expanded-content').setAttribute('aria-hidden', 'true');
                    }
                });
            });
        }

        // initial render
        renderTransactions(transactions);

        // Search filtering
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const q = e.target.value.toLowerCase().trim();
            const filtered = transactions.filter(t => (
                t.id.toLowerCase().includes(q) ||
                t.details.payer.toLowerCase().includes(q) ||
                t.details.service.toLowerCase().includes(q) ||
                String(t.amount).includes(q)
            ));
            renderTransactions(filtered);
        });

        // ------------------------------
        // Revenue chart that "matches" totals
        // ------------------------------
        const ctx = document.getElementById('revenueChart').getContext('2d');

        function generateDailyRevenue(targetTotal, days = 30) {
            // create an upward trend with random noise
            const raw = [];
            let trendBase = targetTotal / days * 0.7; // start lower
            for (let i = 0; i < days; i++) {
                const growth = i * (targetTotal / (days * days)) * (1 + Math.random() * 0.3);
                const noise = (Math.random() - 0.5) * trendBase * 0.6;
                raw.push(Math.max(500, Math.round(trendBase + growth + noise)));
            }
            // Normalize so sum(raw) === targetTotal (small rounding adjustments)
            const sum = raw.reduce((a,b)=>a+b,0);
            const factor = targetTotal / sum;
            const normalized = raw.map(x => Math.round(x * factor));
            // fix rounding difference
            let diff = targetTotal - normalized.reduce((a,b)=>a+b,0);
            let idx = normalized.length - 1;
            while (diff !== 0) {
                normalized[idx] += (diff > 0 ? 1 : -1);
                diff += (diff > 0 ? -1 : 1);
                idx = (idx - 1 + normalized.length) % normalized.length;
            }
            // labels
            const labels = [];
            const today = new Date();
            for (let i = days - 1; i >= 0; i--) {
                const d = new Date(today); d.setDate(d.getDate() - i);
                labels.push(d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
            }
            return { labels, data: normalized };
        }

        // Use totalEarnings as the sum of last 30 days for the example dashboard
        let chartDays = 30;
        let chartDataObj = generateDailyRevenue(totals.totalEarnings, chartDays);

        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(51, 149, 255, 0.28)');
        gradient.addColorStop(1, 'rgba(51, 149, 255, 0.02)');

        const revenueChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: chartDataObj.labels,
                datasets: [{
                    label: 'Revenue',
                    data: chartDataObj.data,
                    borderColor: '#3395FF',
                    backgroundColor: gradient,
                    borderWidth: 2.5,
                    fill: true,
                    tension: 0.36,
                    pointRadius: 0,
                    pointHoverRadius: 6,
                    pointHoverBackgroundColor: '#3395FF',
                    pointHoverBorderColor: '#fff',
                    pointHoverBorderWidth: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: '#02042B',
                        titleColor: '#fff', bodyColor: '#fff', padding: 12, displayColors: false,
                        callbacks: {
                            title: (ctx) => ctx[0].label,
                            label: (context) => fmtINR(context.parsed.y)
                        }
                    }
                },
                scales: {
                    x: { grid: { display: false }, ticks: { maxRotation: 0, autoSkipPadding: 20, color: '#6B7280', font: { size: 11, weight: 500 } } },
                    y: { border: { display: false }, grid: { color: '#F3F4F6' }, ticks: { color: '#6B7280', font: { size: 11, weight: 500 }, callback: function(value) { if (value >= 1000) return '₹' + (value/1000).toFixed(0) + 'K'; return '₹' + value; } } }
                },
                interaction: { intersect: false, mode: 'index' }
            }
        });

        // Timeframe buttons
        document.querySelectorAll('.timeframe-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.timeframe-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const days = parseInt(btn.dataset.days, 10);
                // For longer ranges, estimate targetTotal by scaling (simple heuristic)
                let target = totals.totalEarnings;
                if (days !== 30) {
                    // scale monthly figure to selected range proportionally (approximate)
                    target = Math.round(totals.totalEarnings * (days / 30));
                }
                chartDataObj = generateDailyRevenue(target, days);
                revenueChart.data.labels = chartDataObj.labels;
                revenueChart.data.datasets[0].data = chartDataObj.data;
                revenueChart.update();
            });
        });

        // Update Earnings Function with Animation (keeps totals in sync with chart)
        function updateEarnings(amount) {
            const earningsElement = document.getElementById('totalEarnings');
            const currentValue = parseInt(earningsElement.textContent.replace(/[₹,]/g, ''));
            const newValue = currentValue + amount;
            earningsElement.classList.remove('counter-animate');
            const duration = 1000; const steps = 60; const stepValue = (newValue - currentValue) / steps; let currentStep = 0;
            const counter = setInterval(() => {
                currentStep++;
                const displayValue = Math.round(currentValue + (stepValue * currentStep));
                earningsElement.textContent = fmtINR(displayValue);
                if (currentStep >= steps) {
                    clearInterval(counter);
                    earningsElement.textContent = fmtINR(newValue);
                    void earningsElement.offsetWidth; // reflow
                    earningsElement.classList.add('counter-animate');
                    // update internal totals and regenerate chart data
                    totals.totalEarnings = newValue;
                    chartDataObj = generateDailyRevenue(totals.totalEarnings, chartDays);
                    revenueChart.data.labels = chartDataObj.labels;
                    revenueChart.data.datasets[0].data = chartDataObj.data;
                    revenueChart.update();
                }
            }, duration / steps);
            console.log(`✅ Total Earnings updated: ₹${currentValue.toLocaleString('en-IN')} → ₹${newValue.toLocaleString('en-IN')} (+₹${amount.toLocaleString('en-IN')})`);
        }
        window.updateEarnings = updateEarnings; // expose globally

        // Add transaction dynamically (for demo/testing)
        function addTransaction(tx) {
            transactions.unshift(tx); // add to top
            // update totals and balance approximate
            totals.totalEarnings += tx.amount;
            totals.currentBalance += tx.amount - (tx.details.fees || 0);
            document.getElementById('currentBalance').textContent = fmtINR(totals.currentBalance);
            document.getElementById('totalEarnings').textContent = fmtINR(totals.totalEarnings);
            renderTransactions(transactions);
            // regen chart to reflect new total
            chartDataObj = generateDailyRevenue(totals.totalEarnings, chartDays);
            revenueChart.data.labels = chartDataObj.labels; revenueChart.data.datasets[0].data = chartDataObj.data; revenueChart.update();
        }
        window.addTransaction = addTransaction;

        // Remove loader
        window.addEventListener('load', function () {
            const loader = document.getElementById('loader'); if (!loader) return; loader.style.opacity = '0'; setTimeout(() => { if (loader && loader.parentNode) loader.parentNode.removeChild(loader); }, 300);
        });

        // Console tips (helpful)
        console.log('%cBizzDash Dashboard — updated', 'font-size: 16px; font-weight: bold; color: #3395FF;');
        console.log('%cTry: updateEarnings(5000) or addTransaction({date:\'Jan 31, 2026\', id:\'TXN_DEMO001\', method:\'UPI\', amount:12000, status:\'success\', details:{payer:\'Demo Co\',service:\'One-off dev work\',invoice:\'INV-2026-DEMO\',reference:\'upi:demo@okhdfc\',fees:240,net:11760,notes:\'Demo payment\'}})', 'font-size: 12px; color: #6B7280;');
    </script>
</body>
</html>
